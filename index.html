<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="More about what it does (maybe more than one line)
    Use four spaces when indenting paragraphs within the Description.">
<title>Easily query and process data from Replica Mobility Platform â€¢ replicaToolkitR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Easily query and process data from Replica Mobility Platform">
<meta property="og:description" content="More about what it does (maybe more than one line)
    Use four spaces when indenting paragraphs within the Description.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">replicaToolkitR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/replica_hotspot.html">KDE and Hotspot Workflow</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="replicatoolkitr">replicaToolkitR<a class="anchor" aria-label="anchor" href="#replicatoolkitr"></a>
</h1></div>
<p><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a> <!-- badges: end --></p>
<p>This R package provides a set of functions which allow the user to query and process Replica data. Using user inputs, SQL queries area made to the Replica BigQuery database. The results of those queries are returned to the user in the form of CSVs. Convience functions are then used to convert tabular data to spatial <code>SF</code> objects.</p>
<p>The usage of this package requires the user to have an account with Replica.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"michaelgaunt404/replicaToolkitR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Load the package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://michaelgaunt404.github.io/replicaToolkitR/">replicaToolkitR</a></span><span class="op">)</span></span></code></pre></div>
<p>The run the function <code><a href="reference/query_network_trip_using_bbox.html">query_network_trip_using_bbox()</a></code> to query the replica database given your supplid inputs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/query_network_trip_using_bbox.html">query_network_trip_using_bbox</a></span><span class="op">(</span></span>
<span>  bb_network_layer <span class="op">=</span> <span class="st">'data/req_dev/study_area_network.shp'</span></span>
<span>  ,bb_sa_layer <span class="op">=</span> <span class="st">'data/req_dev/study_area_network.shp'</span></span>
<span>  ,network_table <span class="op">=</span> <span class="st">"replica-customer.northwest.northwest_2021_Q4_network_segments"</span></span>
<span>  ,trip_table <span class="op">=</span> <span class="st">"replica-customer.northwest.northwest_2021_Q4_thursday_trip"</span></span>
<span>  ,customer_name <span class="op">=</span> <span class="st">"replica-customer"</span></span>
<span>  ,file_destination <span class="op">=</span> <span class="st">"data/req_dev"</span></span>
<span>  ,max_record <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  ,query_links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"highway"</span>, <span class="st">"corridor"</span>, <span class="st">"road"</span>, <span class="st">"motorway"</span>, <span class="st">"motorway_link"</span>, <span class="st">"trunk"</span>,</span>
<span>                   <span class="st">"trunk_link"</span>, <span class="st">"primary"</span>, <span class="st">"primary_link"</span>, <span class="st">"secondary"</span>, <span class="st">"secondary_link"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The above function will run and, at times, ask you for inputs that will either continue or terminate the run.</p>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>When completed, the queried data will be written to the location defined by the input <code>file_destination</code>.</p>
<p>6 files will be written, they are:</p>
<ul>
<li>
<code>log_file</code>: Simple text file logging the events of the run. Records the table IDs of the temporary tables that are made in Google BigQuery table during the run. These can be accessed later.<br>
</li>
<li>
<code>replica_queried_network</code>: The network queried by the user. The user will be asked if they want to download this file or not - it can be rather large given query inputs.<br>
</li>
<li>
<code>replica_sa_poly_index</code>: A table containg all polygons found within the user supplied bb_sa_layer polygon.<br>
</li>
<li>
<code>replica_trip_origin_destination</code>: A table containing counts of vehicles aggregated by origin polygon, destination polygon, and vehicle type. Origins and destinations outside of the study area are collapsed into single level called <code>out of study area</code>.<br>
</li>
<li>
<code>replica_trip_origin_links</code>: A table containg counts of vehicle given origin polygon and starting network link. This data set provides a more precise view of vehicle starting locations rather than by its origin polygon (usually census block groups). This is useful when performing hotspot analyses or calcualting kernel desnity estimates (KDEs).<br>
</li>
<li>
<code>table_agg_by_link_subset_limited</code>: A table detailing network link volumes for a given day aggregated by origin polygon and network link</li>
</ul>
<p>All the data listed above are save as CSVs. Conveince functions are provided to convert tabular data to spatial data and save as GPKG or RDS files.</p>
<p>Resulting files in folder after data acquisition.</p>
<p><img src="reference/figures/README_example_file_1.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="data-processing">Data Processing<a class="anchor" aria-label="anchor" href="#data-processing"></a>
</h2>
<p>As indcated above, <code>replicaToolkitR</code> provides convience functions to convert the tabular data acquired through <code><a href="reference/query_network_trip_using_bbox.html">query_network_trip_using_bbox()</a></code> to a spatail format conducive to mapping.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> The functions in this section can be supplied an object to transfrom or location/folder inputs that point to where your data is saved. If the latter is supplied then the function will go and automatically load whatever file the function calls for. Suppling an object directly is compataible with the <code>targets</code> package workflow.</p>
</blockquote>
<p>Acquire origin polygons from the <code>tigris</code> census API package using <code>replica_sa_poly_index</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"replica_sa_poly_index"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/get_tigris_polys_from_replica_index.html">get_tigris_polys_from_replica_index</a></span><span class="op">(</span></span>
<span>  network_object <span class="op">=</span> <span class="va">replica_sa_poly_index</span></span>
<span>  ,states <span class="op">=</span> <span class="st">"WA"</span></span>
<span>  ,auto_save <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Make <code>SF</code> linestring spatial object of network links.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"replica_queried_network"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/make_network_link_layer.html">make_network_link_layer</a></span><span class="op">(</span></span>
<span>  network_object <span class="op">=</span> <span class="va">replica_queried_network</span></span>
<span>  ,auto_save <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Make <code>SF</code> point spatial object by extracting center points from network links.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"replica_queried_network"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/make_network_centroid_layer.html">make_network_centroid_layer</a></span><span class="op">(</span></span>
<span>  network_object <span class="op">=</span> <span class="va">replica_queried_network_links</span></span>
<span>  ,auto_save <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>SF</code> point spatial object of trip first link aggregation table.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"replica_trip_origin_links"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/make_trip_origin_point_layer.html">make_trip_origin_point_layer</a></span><span class="op">(</span></span>
<span>  first_links_object <span class="op">=</span> <span class="va">replica_trip_origin_links</span></span>
<span>  ,auto_save <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Make RDS list object containing network volume aggregation tables.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"table_agg_by_link_subset_limited"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/aggregate_network_links.html">aggregate_network_links</a></span><span class="op">(</span></span>
<span>  network_object <span class="op">=</span> <span class="va">table_agg_by_link_subset_limited</span></span>
<span>  ,auto_save <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The below image shows the saved files in the designated folder after processing.</p>
<p><img src="reference/figures/README_example_file_2.png" width="50%"></p>
<blockquote>
<p><strong><em>NOTE:</em></strong> This functions will always return an object. If you do not choose to <code>auto_save</code> you will still be returned the result. It is advised to <code>auto_save</code> the object at <em>some point</em> as naming conventions will be respected.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="analysis-tools">Analysis Tools<a class="anchor" aria-label="anchor" href="#analysis-tools"></a>
</h2>
<p>This package contains a number of functions that create interactive, filterable leaflet widgets that can aid you in your analysis and research.</p>
<p>Make widget of acquired network links, see example below code:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"replica_queried_network_links"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/inspect_queried_network.html">inspect_queried_network</a></span><span class="op">(</span></span>
<span>  network_links_object <span class="op">=</span> <span class="va">replica_queried_network_links</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/INSPECT_example_1.png" width="100%"></p>
<p>Make widget of network links pre-aggregated a number of ways, see example below code:</p>
<ul>
<li>
<code>make_network_map_anltpt()</code> - <code>A</code>ggregated <code>N</code>etwork <code>L</code>inks by vehicle <code>T</code>ri<code>P</code> <code>T</code>ype</li>
<li>
<code><a href="reference/make_network_map_anlt.html">make_network_map_anlt()</a></code> - <code>A</code>ggregated <code>N</code>etwork <code>L</code>inks by vehicle <code>T</code>ype</li>
<li>
<code>make_network_map_anlt0()</code> - <code>A</code>ggregated <code>N</code>etwork <code>L</code>inks by vehicle <code>T</code>ype and <code>O</code>rigin</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"aggregated_network_links"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"poi_list"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"acquired_sa_polys"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">make_network_map_anltpt</span><span class="op">(</span></span>
<span>  network_cntrd_object <span class="op">=</span> <span class="va">aggregated_network_links</span></span>
<span>  ,poi_list <span class="op">=</span> <span class="va">poi_list</span></span>
<span>  ,origin_polys <span class="op">=</span> <span class="va">acquired_sa_polys</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/make_network_map_anlt.html">make_network_map_anlt</a></span><span class="op">(</span></span>
<span>  network_cntrd_object <span class="op">=</span> <span class="va">aggregated_network_links</span></span>
<span>  ,poi_list <span class="op">=</span> <span class="va">poi_list</span></span>
<span>  ,origin_polys <span class="op">=</span> <span class="va">acquired_sa_polys</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/make_network_map_anlto.html">make_network_map_anlto</a></span><span class="op">(</span></span>
<span>  network_cntrd_object <span class="op">=</span> <span class="va">aggregated_network_links</span></span>
<span>  ,poi_list <span class="op">=</span> <span class="va">poi_list</span></span>
<span>  ,origin_polys <span class="op">=</span> <span class="va">acquired_sa_polys</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/ANLTO_example_1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="what-now">What Now?<a class="anchor" aria-label="anchor" href="#what-now"></a>
</h2>
<p>Lastly, this package contains functions that save basic analysis functions.</p>
<p>Run the below code to create an analysis template.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">replicaToolkitR</span><span class="fu">::</span><span class="fu"><a href="reference/make_query_and_process_replica_script.html">make_query_and_process_replica_script</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>What license is it under?</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing replicaToolkitR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Mike Gaunt <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mike Gaunt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
