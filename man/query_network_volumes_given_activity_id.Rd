% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/query_network_volumes_given_activity_id.R
\name{query_network_volumes_given_activity_id}
\alias{query_network_volumes_given_activity_id}
\title{Extract Replica Network Links by Activity ID Groupings}
\usage{
query_network_volumes_given_activity_id(
  raw_trip_table,
  col_to_split = NULL,
  avoid_str = "qqq",
  add_context,
  data_set_location,
  data_set_type,
  data_set_period,
  customer_name
)
}
\arguments{
\item{raw_trip_table}{A `data.frame` or `data.table` of Replica trips with `activity_id` and optional grouping columns.}

\item{col_to_split}{Character. Name of the column used to group activities (e.g., "time_group"). If `NULL`, all data is grouped as a single network.}

\item{avoid_str}{Character. String pattern to exclude groups from processing. Default is `"qqq"` to filter out nothing.}

\item{add_context}{Character. Descriptive string added as a context column to the result.}

\item{data_set_location}{Character. Location name (e.g., `"maui"`), used to build the BigQuery table name.}

\item{data_set_type}{Character. Type of day or dataset (e.g., `"typical"`).}

\item{data_set_period}{Character. Time period (e.g., `"2022_Q4"`).}

\item{customer_name}{Character. BigQuery project name (e.g., `"replica_customer"`).}
}
\value{
A `data.table::data.table` containing:
- `network_link_ids_unnested`: Link ID
- `count`: Aggregated number of trips
- `split_col_type`: Name of the grouping column
- `split_col_value`: Value of the group
- `data_set_location`, `data_set_period`, `data_set_day`, `context`: Metadata columns
}
\description{
This function extracts network link-level counts from a Replica trip table,
filtered and grouped by a user-defined attribute (such as time of day or spatial tag).
It allows for flexible post-processing of a Replica trip dataset by re-tagging or grouping `activity_id`s
based on downstream analysis and then querying associated network links for each group.
}
\details{
The function expects a `raw_trip_table` that already contains a subset of trips from Replica (e.g., trips on Maui).
After performing post-hoc classification (e.g., tagging activities by time window or location),
users can extract a network profile per unique group in a specified column.
This function constructs dynamic SQL queries to query the Replica dataset (via BigQuery) and
aggregates the number of trips per network link (`network_link_ids_unnested`) for each group.

The function performs the following:
- Validates or creates a grouping column (`col_to_split`).
- Filters out any groups containing a string (`avoid_str`) to skip.
- Constructs SQL queries per group of `activity_id`s.
- Executes BigQuery queries to retrieve and aggregate network links.
- Returns a combined table of network link usage per group, annotated with context and dataset metadata.
}
\examples{
\dontrun{
# Assuming you have already loaded and filtered Replica trips into raw_trip_table
trips_tagged = raw_trip_table \%>\%
  dplyr::mutate(time_group = dplyr::case_when(
    hour_of_day < 12 ~ "morning",
    TRUE ~ "afternoon"
  ))

network_links = query_network_volumes_given_activity_id(
  raw_trip_table = trips_tagged,
  col_to_split = "time_group",
  avoid_str = "test",
  add_context = "Maui AM/PM comparison",
  data_set_location = "maui",
  data_set_type = "typical",
  data_set_period = "2022_Q4",
  customer_name = "replica_customer"
)
}
}
